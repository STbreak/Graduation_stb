#pdbとrandomとRSAとPKCS1のライブラリ導入
import pdb
import random
from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_OAEP


'''
<<Step1：GCIDの作成>>
・型はbytes型
・上位128bitはとりあえず適当な128bitにする
・秘密鍵はpythonのやつだと1191byteだった
・GCIDは1207byteになる
'''


#平文（GCIDの上位128bit,type:bytes）の作成
len_gcid_upper = 16
gcid_upper = random.randrange(2 ** 128).to_bytes(len_gcid_upper, 'big')

#秘密鍵の作成
private_key = RSA.generate(2048)
len_private = len(private_key.export_key('DER')) #len_private：秘密鍵のbyte長

#秘密鍵に基づく公開鍵の生成
public_key = private_key.publickey()

#GCID(bytes)の作成
GCID_int = (int.from_bytes(gcid_upper, 'big') << (len_private * 8)) | int.from_bytes(private_key.export_key('DER'), 'big') #gcid_upperの後に秘密鍵をくっつける

GCID = GCID_int.to_bytes(len_gcid_upper + len_private, 'big')

#GCIDの出力

print("Made GCID:\n{}\n".format(GCID))




'''
<<Step2：VCLの作成>>
・型はbytes型
・上位128bit
・シーケンス128bit（仮）
・暗号文256byte
・合わせて288byteになる
'''



#VCLの上位128bitの作成
vcid_upper = random.randrange(2 ** 128).to_bytes(16, 'big')

#シーケンス（とりあえず128bit）の作成
len_sequence = 16
sequence = random.randrange(2 ** (len_sequence * 8)).to_bytes(16, 'big')

#平文（上位128bitとシーケンスの合計）の作成
vcid_plain_int = (int.from_bytes(vcid_upper, 'big') << (len_sequence * 8)) | int.from_bytes(sequence, 'big') #vcid_plain（int型）の作成)
vcid_plain = vcid_plain_int.to_bytes(16 + len_sequence, 'big')

#暗号文の作成
cipher = PKCS1_OAEP.new(public_key)
ciphertext = cipher.encrypt(vcid_plain)
len_ciphertext = len(ciphertext)

#VCLの作成
VCID_int = (int.from_bytes(vcid_plain, 'big') << (len_ciphertext * 8)) | int.from_bytes(ciphertext, 'big')
VCID = VCID_int.to_bytes(16 + len_sequence + len_ciphertext, 'big')

#VCIDの出力

print("Made VCID:\n{}\n".format(VCID))




'''
1206 VCIDできた！！


result

Made GCID:
b'\xa9\x10\xa4f\x14DT\x13[8\xaa=\x13\xd4\x91\xf30\x82\x04\xa3\x02\x01\x00\x02\x82\x01\x01\x00\xa8\xb5\xf6\xba\xf9s:\xc4\xda\x89\xfe\x1bdo\x9cie\xd2y\xeb\xee\xcc"\xff8\xa3\x81"\x83\x19\xb98`\xb6A\x7f\x90\x0f\xbe\xcc\xb0\xb7\xf4@\xeaxmbp\t\x18\xe4\x85\xa7k\x8a\xf6\x83sOP\x060p\x91\xf1\n4^\x8fX8\xd8\x17\xb5\xf9\xe8s\xde\x86\r6\xc3\xff\x1d\xcb\x1b@\xdc\xa9!\xbc\xca\xe1\xec\xc9a^\x98I\xcc\xfa\x04\x0e\x8b)\r\x80*\xb2T\xe4yV</\xe6\xc55\x1c\x1a\xc5\x08\xf3k\xa4\xa5\xb6\xe0\xf7\x91\xff!\x88\x80<\xa46k.B\xc1u\x9f9\xc0\xfe\x1c\xdf\x8f\x08\xfc\xf3\xff\xfd\xd8\xb0\x8dU\xa8\x01;)[\xbb 4\x11G\xf0\xfd\xee\xc5\x17\xea\x9bbfi\xae\xab\x94_\x11@l\xdf\x02U!\x13N\x8dM\xd8\x04\xd2\xe7\xc6\x08\x93\xd3\x07\xfc\x0e\xf0\x18\x97n[\xe7\xd7\xdc\x95\xee2\xed\x19Y\xc3\xabe\xb8\x12M\xce\x07\x18\xc7W\x14\xb1\x84\x19\x1b\xdd\xdc\\0^\xfc\x171\n\xb3\x030\x8b\x1f\x7f\x1f2b]\xd7\x0b\x02\x03\x01\x00\x01\x02\x82\x01\x00\x14\xaa\x95\x9a\xb9\xcb\xdf\xbb\x15z)\xe2y\x1f"\xed\xd6G> $\x94e\x05\x16\x8f\x10\xd6\x85p\xb5;\xae\xbd$\xb0\xd7\x98\xd6*\x84\xcbC\xe4_\xd4x\xb1\xc2?\x9b\t\x03FJ\xea.\xe0SS\xb7\xdd\xca9?\xe7b\xf4\x9fP\xb7\xe1\xde\xb6\xa8\xd8\x00\x1d\x91x\xa2M\xbf\x1c\x95-\xb8\x1c\xed\xea\xd9\xf3"w"fX\xc3\x19\xac\x90\xab_\xab\xd8h"\xfb<?\xb4\x1ex\xae\x93\x98\xda\x8f\xf5\xbd\x87\x99\xf3J\xbe8\xe1\x03\x9e\xc8M|S\x8d4Q\x1em\xd5\xf7\xcd\xfa\xb5\xfe\xa7\xe7\xd8c\x9a%\x84\xb4\xfc\x8c\xad\xa3\xccfn\xd8\xdd\xa6\x83\xda\xb7a\xe5l\xdb\x91\xad\xe0S,\x8a\xf8\xc0\x9b\xcf\x9c\xa3\x85\xf02\x89\x9a\x16\xb5\x86\xbf\xa9\xaa\x90\x1d\xe3\xe5\xc4\xf4?\xac\x03F\x026\x92\xd0\xe0\xfd\xa75$G\xf4 \x19>Z\x12<\xa9\x06\xaf\xb0n&\xd3\xb6\x9f\\\xce\x1c\xa1n\xfa\xf9\xdfHx5\x9e|\xf7\xe6#\x9f\x92-y=\xadyHV\xa1r\x01\x02\x81\x81\x00\xbc#\xc4#\xa2t\x15\xfa\x8aK\xc3\xe7L"\x10Z\xba\xa2\x11|\xa3\xa2V\xd9\xc5\x10\xa8\x8cm\xfe\xef\xa7\xd9#\xd0\xe5\xf6T\xc8\xf2\x05\x9a\xf7\xc7AC\x10p\xecPW\xc1EVB_\xf0\x13\x0f&\x12\x0cXh<\xcc&o\xbaj\x04\x05v\x14\xb3\xc7\x91\xaeq.\xc5\x8f\xa7yZE\xe5\xc4\xa0\xceN\x06\xef\xc4\x90\x88\xe1Z\xcd\xbd\xa8\xc8\xdb\x81\xa0\x02\x1f\x81\x0e\x8d\x8fX\x92\x03\xd7\x95\xc5."\tL\xea\xd7I8\xb5\x8e\xcb\x02\x81\x81\x00\xe5\x9013\x9aS\xd0:\x1a\xf8j\xa3\x0f\x08_{\xeb\xf8\xc6\xc2\x97\xba8\xa0f\x9fj3\x93\xbc\x98\xca\x0e\xda\xf6\xf8G\xc5\xc7\xc4\x06\xd0\xaf9\xfa\x0b\xc2fL\x1afZ|:*\xb5V\x94\xbbV(!\x16\xec \x05\x95gg\x82\x95\xbe$\xb1\xc8\x01N\xb7\x85\x04$\r\x93>z\xe9\xb0\xfa\x80P\xf4)\xcf\xe3A_\x19{\x16\r\x95\xc5h\x86!,\xc5/\xf5<\xc4\xc8\x15\xf1\x10\xe4\xdd\xd4\xa4\x04\xb87t\x7f+!\x90\xc1\x02\x81\x81\x00\xb7\x1f\xe1\x14\x06V\x13\xe6\x8f\xa1\xfb\x871\x15\x9e\xf1\x90\xe3\x9b=\xc4P\x89T\xe2y\xbau%\xc3\x95%\xbd7\x1dh\x18\x82\xa2,\xe0\xc3\xdc\x15x2|\xd8MLN~r\xac\xe9bT]X\xcbg\x99\xd8\x9bmB\x10\xcf\x83\x95\x19`\xeftk \xffm\xda\x00\xfa\x8f?%\xe1vS\x956(X\xcek\xa6\xda@A\x89\x8e\xe4\xe2Z\xcf=\xb6\xaf\x1aW\x16\x017\xdb\xb0\x14IM f,\xfe\xfc}A\x1b\xa65"M\x02\x81\x80Ee\xc5\xb9\xf7\xd9\x86\x85JI\xf6\xd2\xbcd\xa7\x98\xea\xc9\x16-\x15y2M+8\xdd\xfe!\x97N\t\'\\\x82t\xa4\x1d\xe2:\x1ceQ\xd3\x91\x07\xa5\t\x0f\xd0\x9bH\x97mn#\xcb\xbc\xc2\xb5U\x04K\xcd\xae\x10\x82\r\xf4x\xc1\x93\xed\xbb\xe0\xde\xa4QN`\xe6\x15D\x82\n\xdeB\xa67\xccAC\xb2\x98\xdc\xd6F\xf9\xb2\xbd\x00\x9d\xe0\xefKp!\\R"\xc0\xcaK\xf7\xc8G\xa7\xd7\xf4\x8d\x88\xb3\x1b\x00\xa6\xa5K\x01\x02\x81\x80&G\xfe\xc7\x8e\xfc\xb6o\xe8u\xd2\xae\xa7\xc5\x82\x84\xcda\xa5\x1bZ\x96PR\x9eV8\xff6\xd1t\x91?\x98\t\x83G\xd6|\xf0T4\x8d\xe8\xd0\xb4\xc7\xd9\x9c!\x12\xa1-\x8ef\xedT\xc5\x10\x10\x99;\x99\xde\xc6pCO}@\x91;\xda\xb4\x8fRr\r\xa0\xb4UVQa2\xaa\x93\x02bV\x9a\xe8D\x1c\xfe\xc4\x12\xf5\xac\x92o\x07i\xa5C\xbe\xfc\xa3n\xf6D\xab`\xb1\xfc\xe8\xb7\x0f\xdd\x85\x84\x14V\xd2\x8eK\x8a?'

Made VCID:
b'\x05\x86_\xb0\xa5A\xcf\x84\xef\xb6\xec\nOn\xa9\x0049\xfer\xbb\x1fM\xea=\x9b\xcd\xde\xc1\x97\xec[b\xb6\x01\xa2\x94\xef"QHK\\\xb4\xe3\x02\x9d\xbcN`\x90\x9f?\xa00\xf5\xc7\xde\xe6\xf1\x04m\x82\xe8\x819&O]\x8a\xb0m\xe7#\xdc\xd9]\xa5\xec\xe9\xbb\x11\xd71b\xc9\x0c\xa7,"\xbf\x1aI\x1a\x85\x05\x04g\x0bY\xef\x9c~A+\x94&\xcf_\xff1\xea\xb3\x9a\xf1\xa6\xe5d\xf4\xc3\xe9g\xce\xf6\x10\xd4\x9a\xba:\xeb\x17\xae\x18\'\xa6\xed\x8b\xec\x17,\x89\xfd$\xb6\x9d$5\x1f\xcf\xe9\xc4\x1e\x00\xc6\xdc\xdda\xf7\x14\xb1\xdbV\xff\xa3D\xc6\xe3e\xf1\xd3yr:\x94pUT\xc9\xb3\xa1\x8c\xf0\xe4IJ\x80%\x9a\x9c\x93\xab9\x19\\E\xa65\x7f\xf6\n\xccw\x86\xb7\xd0l=0:\x93\xc3\x12Y?0]\x9b \xa7\xd4\x1c\xd9_vCQ.\xdb\x8ahLX\xd9\xc5\xcd\xc2\xeb\xdc\x8c\xa1W+?\xe2\xa2\xbe\xbe@y\xb1\xd9\xf5\xb5NJ\xad\xde\x8a\xf3$\xb3q\xed\x8c\xd0\xe8\xe9;\xf2\x9a\x06K\xc5\xae)\xfd\xe3\xddJjo\xa7\xa3\x84\xc5*Go'



'''
